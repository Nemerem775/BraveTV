<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin â€” Anonymous Messages</title>
<style>
  :root{
    --bg: #0f1724;
    --card: #0b1220;
    --accent: #7c5cff;
    --text: #e6eef8;
    --muted: #a6b0c3;
    --bubble-bg: #161d2f;
  }

  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background:var(--bg);
    color:var(--text);
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:24px;
  }

  .card{
    width:100%;
    max-width:600px;
    background:var(--card);
    border-radius:14px;
    padding:20px;
    border:1px solid rgba(255,255,255,0.03);
    box-shadow:0 6px 24px rgba(0,0,0,0.4);
  }

  h2{
    margin:0 0 10px 0;
  }

  .hint{
    font-size:13px;
    color:var(--muted);
    margin-bottom:12px;
  }

  input[type=password]{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.04);
    background:transparent;
    color:var(--text);
    margin-bottom:12px;
  }

  button{
    padding:8px 12px;
    border-radius:8px;
    border:none;
    background:var(--accent);
    color:#021028;
    font-weight:700;
    margin-right:6px;
    cursor:pointer;
  }

  .notice{
    font-size:13px;
    color:var(--muted);
    margin-bottom:10px;
  }

  .feed{
    max-height:400px;
    overflow-y:auto;
    border:1px solid rgba(255,255,255,0.03);
    border-radius:12px;
    padding:10px;
    background:rgba(255,255,255,0.02);
  }

  .message{
    background:var(--bubble-bg);
    padding:10px;
    border-radius:12px;
    margin-bottom:10px;
    word-wrap:break-word;
    font-size:14px;
  }

  .timestamp{
    font-size:11px;
    color:var(--muted);
    margin-bottom:4px;
  }

  .hidden{display:none;}
</style>
</head>
<body>
<div class="card">
  <h2>Admin Panel</h2>
  <div class="hint">Enter the password to view all anonymous messages.</div>

  <input type="password" id="pwd" placeholder="Admin password" />
  <button onclick="unlock()">Unlock</button>

  <div id="content" class="hidden">
    <div class="notice">Messages load automatically from Google Sheets. Auto-refresh every 30 seconds. Newest messages appear on top.</div>
    <div class="feed" id="feed"></div>
    <div style="margin-top:12px;">
      <button onclick="fetchMessages()">Refresh Now</button>
      <button onclick="clearFeed()">Clear Feed</button>
    </div>
  </div>
</div>

<script>
  const ADMIN_PASSWORD = "BraveTV123"; // CHANGE TO YOUR PASSWORD
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS8-G3M1utnd_XbpOliIjZtIc9KWTvCLtSb9BiKOUpwKRNB5HIL21XXeab3UpAGy1KXXdKixcw-b5ns/pubhtml"; // Google Sheets CSV link
  let autoRefresh;

  function unlock(){
    const v = document.getElementById("pwd").value || "";
    if(v === ADMIN_PASSWORD){
      document.getElementById("content").classList.remove("hidden");
      fetchMessages(); // fetch immediately
      autoRefresh = setInterval(fetchMessages, 30000); // every 30s
    } else alert("Wrong password!");
  }

  async function fetchMessages(){
    try{
      const res = await fetch(CSV_URL);
      if(!res.ok) throw new Error("Network error " + res.status);
      const text = await res.text();
      const rows = csvToArray(text);
      renderFeed(rows);
    } catch(e){
      alert("Failed to load messages: " + e.message);
    }
  }

  function csvToArray(csvText){
    const lines = csvText.split(/\r?\n/).filter(l=>l.trim().length>0);
    return lines.map(line=>{
      const out=[]; let cur="", inQuotes=false;
      for(let i=0;i<line.length;i++){
        const ch = line[i];
        if(ch === '"'){ inQuotes=!inQuotes; continue; }
        if(ch === ',' && !inQuotes){ out.push(cur); cur=""; continue; }
        cur+=ch;
      }
      out.push(cur);
      return out;
    });
  }

  function renderFeed(rows){
    const feed = document.getElementById("feed");
    feed.innerHTML = "";
    if(!rows || rows.length<=1){
      feed.innerHTML = "<div class='message'>No messages yet.</div>";
      return;
    }

    let data = rows.slice(1).reverse(); // newest first

    data.forEach(r=>{
      const ts = r[0] || "";
      const msg = r[1] || "";
      const div = document.createElement("div");
      div.className = "message";
      div.innerHTML = `<div class="timestamp">${escapeHtml(ts)}</div><div>${escapeHtml(msg)}</div>`;
      feed.appendChild(div);
    });
  }

  function clearFeed(){ document.getElementById("feed").innerHTML=""; }
  function escapeHtml(s){ return String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }
  window.addEventListener("beforeunload", ()=> clearInterval(autoRefresh));
</script>
</body>
</html>
