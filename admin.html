<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin — Anonymous Messages</title>
<style>
  body{font-family:Inter,system-ui; margin:0; background:#0b1220;color:#dfe9fb;display:flex;align-items:center;justify-content:center;height:100vh;padding:20px}
  .card{width:100%;max-width:820px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
  h2{margin:0 0 6px 0}
  .hint{color:#a9b6d9;font-size:13px;margin-bottom:12px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  input[type=password]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  button{padding:10px 12px;border-radius:8px;border:none;background:#7c5cff;color:#021028;font-weight:700}
  .danger{background:#ff6b6b;color:white}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left;font-size:14px}
  pre{white-space:pre-wrap;background:rgba(255,255,255,0.02);padding:8px;border-radius:6px}
  .notice{margin-top:12px;color:#b6c5eb;font-size:13px}
</style>
</head>
<body>
  <div class="card" id="card">
    <h2>Admin panel</h2>
    <div class="hint">This admin page is lightweight. Enter the admin password to reveal instructions and (optionally) view responses from a published Google Sheet.</div>

    <div id="loginBox" class="row">
      <input id="pwd" type="password" placeholder="Admin password (change in code)" />
      <button onclick="unlock()">Unlock</button>
    </div>

    <div id="content" style="display:none">
      <p class="notice"><strong>Quick links:</strong>
        • Open Google Forms editor: <a href="https://forms.google.com" target="_blank" rel="noopener">forms.google.com</a>
        • Open Google Sheets: <a href="https://sheets.google.com" target="_blank" rel="noopener">sheets.google.com</a>
      </p>

      <h3>How to see responses inside this page (optional, 2 steps)</h3>
      <ol>
        <li>In Google Forms → Responses → click the green Sheets icon to link responses to a Google Sheet.</li>
        <li>In Google Sheets → File → Publish to the web → choose the sheet and **CSV** format → Publish. Copy the CSV link.</li>
      </ol>

      <div style="margin-top:10px;">
        <label>Paste your published CSV URL below:</label>
        <input id="csvUrl" style="width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" placeholder="https://docs.google.com/spreadsheets/d/e/.../pub?output=csv" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button onclick="loadResponses()">Load responses</button>
          <button class="danger" onclick="clearTable()">Clear table</button>
        </div>
      </div>

      <div id="tableWrap" style="margin-top:14px"></div>

      <p class="notice">Security note: this admin page uses a client-side password to hide the UI — it's convenient but not bulletproof. For stronger protection use a proper server or GitHub Pages + Cloudflare Access or protect your sheet by keeping it unshared and opening responses only when logged into your Google account.</p>
    </div>
  </div>

<script>
  // === SECURITY: change this password before publishing ===
  // This is client-side protection for convenience only.
  const ADMIN_PASSWORD = "BraveTV123"; // <-- change to your own password

  function unlock(){
    const v = document.getElementById("pwd").value || "";
    if(v === ADMIN_PASSWORD){
      document.getElementById("loginBox").style.display = "none";
      document.getElementById("content").style.display = "block";
    } else {
      alert("Wrong password");
    }
  }

  async function loadResponses(){
    const url = document.getElementById("csvUrl").value.trim();
    if(!url){ alert("https://docs.google.com/spreadsheets/d/e/2PACX-1vS8-G3M1utnd_XbpOliIjZtIc9KWTvCLtSb9BiKOUpwKRNB5HIL21XXeab3UpAGy1KXXdKixcw-b5ns/pub?output=csv."); return; }
    try {
      const res = await fetch(url);
      if(!res.ok) throw new Error("Network error: " + res.status);
      const text = await res.text();
      const rows = csvToArray(text);
      renderTable(rows);
    } catch(e){
      alert("Failed to load CSV: " + e.message);
    }
  }

  function csvToArray(csvText){
    // simple CSV -> 2D array (works for forms' CSV)
    const lines = csvText.split(/\r?\n/).filter(l => l.trim().length>0);
    const rows = lines.map(line => {
      // naive CSV parse (handles quoted commas)
      const out = [];
      let cur = "", inQuotes=false;
      for(let i=0;i<line.length;i++){
        const ch = line[i];
        if(ch === '"' ){ inQuotes = !inQuotes; continue; }
        if(ch === ',' && !inQuotes){ out.push(cur); cur = ""; continue;}
        cur += ch;
      }
      out.push(cur);
      return out;
    });
    return rows;
  }

  function renderTable(rows){
    if(!rows || rows.length===0){ document.getElementById("tableWrap").innerHTML = "<p>No responses yet.</p>"; return; }
    const headers = rows[0];
    const body = rows.slice(1);

    let html = "<table><thead><tr>";
    for(const h of headers) html += "<th>" + escapeHtml(h) + "</th>";
    html += "</tr></thead><tbody>";
    for(const r of body){
      html += "<tr>";
      for(const c of r) html += "<td><pre>" + escapeHtml(c) + "</pre></td>";
      html += "</tr>";
    }
    html += "</tbody></table>";
    document.getElementById("tableWrap").innerHTML = html;
  }

  function clearTable(){ document.getElementById("tableWrap").innerHTML = ""; }

  function escapeHtml(s){ return String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }
</script>
</body>
</html>
